<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="分布式事务 微服务化带来的分布式事务问题 每一个服务内部的数据一致性仍由本地事务来保证。而整个业务层面的全局数据一致性要如何保障呢？
解决方案 分布式事务的实现主要有以下 5 种方案：
 XA 方案 TCC 方案 本地消息表 可靠消息最终一致性方案 最大努力通知方案  如果你真的被问到，可以这么说，我们某某特别严格的场景，用的是 TCC 来保证强一致性；然后其他的一些场景基于阿里的 RocketMQ 来实现分布式事务。
你找一个严格资金要求绝对不能错的场景，你可以说你是用的 TCC 方案；如果是一般的分布式事务场景，订单插入之后要调用库存服务更新库存，库存数据没有资金那么的敏感，可以用可靠消息最终一致性方案。
友情提示一下，RocketMQ 3.2.6 之前的版本，是可以按照上面的思路来的，但是之后接口做了一些改变，我这里不再赘述了。
当然如果你愿意，你可以参考可靠消息最终一致性方案来自己实现一套分布式事务，比如基于 RocketMQ 来玩儿。
参考：
 分布式事务了解吗？你们是如何解决分布式事务问题的？  XA 方案 两阶段提交方案
有一个事务管理器的概念，负责协调多个数据库（资源管理器）的事务，事务管理器先问问各个数据库你准备好了吗？ 如果每个数据库都回复 ok，那么就正式提交事务，在各个数据库上执行操作；如果任何其中一个数据库回答不 ok，那么就回滚事务。
这种分布式事务方案，比较适合单块应用里，跨多个库的分布式事务，而且因为严重依赖于数据库层面来搞定复杂的事务，效率很低，绝对不适合高并发的场景。
如果要玩儿，那么基于 Spring &#43; JTA 就可以搞定，自己随便搜个 demo 看看就知道了。
这个方案，我们很少用，一般来说某个系统内部如果出现跨多个库的这么一个操作，是不合规的。
 TCC 这种方案说实话几乎很少人使用， 因为这个事务回滚实际上是严重依赖于你自己写代码来回滚和补偿了，会造成补偿代码巨大，非常之恶心，业务代码是很难维护的。
比如说我们，一般来说跟钱相关的，跟钱打交道的，支付、交易相关的场景，我们会用 TCC，严格保证分布式事务要么全部成功，要么全部自动回滚，严格保证资金的正确性，保证在资金上不会出现问题。
而且最好是你的各个业务执行的时间都比较短。
TCC 分布式事务框架，比如国内开源的
 ByteTCC himly tcc-transaction  Try 首先你的业务的主流程以及各个接口提供的业务含义，不是说直接完成那个业务操作，而是完成一个 Try 的操作。
这个操作，一般都是锁定某个资源，设置一个预备类的状态，冻结部分数据，等等，大概都是这类操作。
Confirm Cancel 参考："><meta property="og:title" content="分布式事务" />
<meta property="og:description" content="分布式事务 微服务化带来的分布式事务问题 每一个服务内部的数据一致性仍由本地事务来保证。而整个业务层面的全局数据一致性要如何保障呢？
解决方案 分布式事务的实现主要有以下 5 种方案：
 XA 方案 TCC 方案 本地消息表 可靠消息最终一致性方案 最大努力通知方案  如果你真的被问到，可以这么说，我们某某特别严格的场景，用的是 TCC 来保证强一致性；然后其他的一些场景基于阿里的 RocketMQ 来实现分布式事务。
你找一个严格资金要求绝对不能错的场景，你可以说你是用的 TCC 方案；如果是一般的分布式事务场景，订单插入之后要调用库存服务更新库存，库存数据没有资金那么的敏感，可以用可靠消息最终一致性方案。
友情提示一下，RocketMQ 3.2.6 之前的版本，是可以按照上面的思路来的，但是之后接口做了一些改变，我这里不再赘述了。
当然如果你愿意，你可以参考可靠消息最终一致性方案来自己实现一套分布式事务，比如基于 RocketMQ 来玩儿。
参考：
 分布式事务了解吗？你们是如何解决分布式事务问题的？  XA 方案 两阶段提交方案
有一个事务管理器的概念，负责协调多个数据库（资源管理器）的事务，事务管理器先问问各个数据库你准备好了吗？ 如果每个数据库都回复 ok，那么就正式提交事务，在各个数据库上执行操作；如果任何其中一个数据库回答不 ok，那么就回滚事务。
这种分布式事务方案，比较适合单块应用里，跨多个库的分布式事务，而且因为严重依赖于数据库层面来搞定复杂的事务，效率很低，绝对不适合高并发的场景。
如果要玩儿，那么基于 Spring &#43; JTA 就可以搞定，自己随便搜个 demo 看看就知道了。
这个方案，我们很少用，一般来说某个系统内部如果出现跨多个库的这么一个操作，是不合规的。
 TCC 这种方案说实话几乎很少人使用， 因为这个事务回滚实际上是严重依赖于你自己写代码来回滚和补偿了，会造成补偿代码巨大，非常之恶心，业务代码是很难维护的。
比如说我们，一般来说跟钱相关的，跟钱打交道的，支付、交易相关的场景，我们会用 TCC，严格保证分布式事务要么全部成功，要么全部自动回滚，严格保证资金的正确性，保证在资金上不会出现问题。
而且最好是你的各个业务执行的时间都比较短。
TCC 分布式事务框架，比如国内开源的
 ByteTCC himly tcc-transaction  Try 首先你的业务的主流程以及各个接口提供的业务含义，不是说直接完成那个业务操作，而是完成一个 Try 的操作。
这个操作，一般都是锁定某个资源，设置一个预备类的状态，冻结部分数据，等等，大概都是这类操作。
Confirm Cancel 参考：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ikingye.github.io/note-cs/docs/direction/be/distributed/transaction/" />
<meta property="article:modified_time" content="2020-05-29T15:19:21+08:00" />
<title>分布式事务 | 计算机学习笔记</title>
<link rel="icon" href="/note-cs/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/note-cs/book.min.f4b9d5273a44ceb8244e6fb74f9c854fbeac86646cbd4889c01eb78337b6042f.css" integrity="sha256-9LnVJzpEzrgkTm&#43;3T5yFT76shmRsvUiJwB63gze2BC8=">


<script defer src="/note-cs/en.search.min.dfaee4c118f8be2b78e1bfd70ab26763936f6cbbddc0fd2518a2c9d492848002.js" integrity="sha256-367kwRj4vit44b/XCrJnY5NvbLvdwP0lGKLJ1JKEgAI="></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/note-cs"><span>计算机学习笔记</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



<ul>
  <li><a href="https://kingye.me" target="_blank" rel="noopener noreferrer">博客</a></li>
  <li><a href="https://github.com/ikingye" target="_blank" rel="noopener noreferrer">
    Github  <img src="https://img.shields.io/github/followers/ikingye.svg?label=%E5%85%B3%E6%B3%A8">
  </a></li>
  <li><a href="https://weibo.com/kingyip15215" target="_blank" rel="noopener noreferrer">
    微博  <img src="http://www.sinaimg.cn/blog/developer/wiki/LOGO_16x16.png">
  </a></li>
  <li><a href="https://www.zhihu.com/people/wutongyip" target="_blank" rel="noopener noreferrer">知乎</a></li>
</ul>
<hr />








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li>
    

  
  <span>第一部分 基础</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/basic/computer-composition/" class="">1.1 计算机组成原理</a>
  


    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/basic/os/" class="collapsed ">1.2 操作系统</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/basic/algs/" class="">1.3 数据结构与算法</a>
  


    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/basic/network/" class="">1.4 计算机网络</a>
  


    




  
  <ul>
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/basic/pl/" class="collapsed ">1.5 编程语言</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/basic/db/" class="collapsed ">1.6 数据库</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/basic/compile/" class="collapsed ">1.7 编译原理</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <span>第二部分 方向</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/" class="collapsed ">2.1 后端</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/web-service/" class="collapsed ">Web Service</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/proxy/" class="collapsed ">代理</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/platform/" class="collapsed ">平台</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/search/" class="collapsed ">搜索引擎</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/microservices/" class="collapsed ">微服务</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/mq/" class="collapsed ">消息队列</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/distributed/" class="collapsed ">分布式系统</a>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/distributed/paxos/" class="collapsed ">Paxos</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/distributed/raft/" class="collapsed ">Raft</a>
  


    






  </li>


      
    
      
        <li>

  
  <a href="/note-cs/docs/direction/be/distributed/consul/" class="">Consul</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note-cs/docs/direction/be/distributed/etcd/" class="">Etcd</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note-cs/docs/direction/be/distributed/zookeeper/" class="">Zookeeper</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note-cs/docs/direction/be/distributed/consistent-hashing/" class="">一致性哈希</a>
  

</li>
      
    
      
        <li>

  
  <a href="/note-cs/docs/direction/be/distributed/transaction/" class="active">分布式事务</a>
  

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/auth/" class="collapsed ">认证与授权</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/be/frame/" class="collapsed ">框架</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/fe/" class="collapsed ">2.2 前端</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/client/" class="collapsed ">2.3 客户端</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/embedded/" class="collapsed ">2.4 嵌入式</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/security/" class="collapsed ">2.5 安全</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/mp/" class="collapsed ">2.6 中台</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/direction/se/" class="collapsed ">2.8 软件工程</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <span>第三部分 领域</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/domain/cc/" class="collapsed ">3.1 云计算</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/domain/bigdata/" class="collapsed ">3.2 大数据</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/domain/ai/" class="collapsed ">3.3 人工智能</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <span>第四部分 其他</span>
  


    




  
  <ul>
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/others/skill/" class="collapsed ">4.2 技能树</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/others/tool/" class="collapsed ">4.3 工具</a>
  


    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/book/" class="collapsed ">第五部分 读书</a>
  


    






  </li>


      
    
      
        

  <li>
    

  
  <a href="/note-cs/docs/course/" class="collapsed ">第六部分 课程</a>
  


    






  </li>


      
    
  </ul>
  



  















<hr />
<ul>
  <li><a href="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200417021727.png" target="_blank" rel="noopener noreferrer">关注微信公众号</a></li>
  <li><a href="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200428110046.png" target="_blank" rel="noopener noreferrer">请我喝饮料</a></li>
  <li><a href="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200417022040.png" target="_blank" rel="noopener noreferrer">加我微信</a></li>
</ul>

</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/note-cs/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>分布式事务</strong>

  <label for="toc-control">
    <img src="/note-cs/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#分布式事务">分布式事务</a>
      <ul>
        <li><a href="#微服务化带来的分布式事务问题">微服务化带来的分布式事务问题</a></li>
        <li><a href="#解决方案">解决方案</a></li>
        <li><a href="#xa-方案">XA 方案</a>
          <ul>
            <li><a href="#tcc">TCC</a>
              <ul>
                <li><a href="#try">Try</a></li>
                <li><a href="#confirm">Confirm</a></li>
                <li><a href="#cancel">Cancel</a></li>
              </ul>
            </li>
            <li><a href="#本地消息表">本地消息表</a></li>
            <li><a href="#可靠消息最终一致性方案">可靠消息最终一致性方案</a></li>
            <li><a href="#最大努力通知方案">最大努力通知方案</a></li>
            <li><a href="#开源实现">开源实现</a>
              <ul>
                <li><a href="#seataseatahttpsgithubcomseataseata-github-starshttpsimgshieldsiogithubstarsseataseatasvg"><a href="https://github.com/seata/seata">seata/seata</a> <img src="https://img.shields.io/github/stars/seata/seata.svg" alt="Github stars"></a></li>
                <li><a href="#华为-dtm">华为 DTM</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="分布式事务">分布式事务</h1>
<h2 id="微服务化带来的分布式事务问题">微服务化带来的分布式事务问题</h2>
<p>每一个服务内部的数据一致性仍由本地事务来保证。而整个业务层面的全局数据一致性要如何保障呢？</p>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200528160805.png" alt="" /></p>
<h2 id="解决方案">解决方案</h2>
<p>分布式事务的实现主要有以下 5 种方案：</p>
<ul>
<li>XA 方案</li>
<li>TCC 方案</li>
<li>本地消息表</li>
<li>可靠消息最终一致性方案</li>
<li>最大努力通知方案</li>
</ul>
<p>如果你真的被问到，可以这么说，我们某某特别严格的场景，用的是 TCC 来保证强一致性；然后其他的一些场景基于阿里的 RocketMQ 来实现分布式事务。</p>
<p>你找一个严格资金要求绝对不能错的场景，你可以说你是用的 TCC 方案；如果是一般的分布式事务场景，订单插入之后要调用库存服务更新库存，库存数据没有资金那么的敏感，可以用可靠消息最终一致性方案。</p>
<p>友情提示一下，RocketMQ 3.2.6 之前的版本，是可以按照上面的思路来的，但是之后接口做了一些改变，我这里不再赘述了。</p>
<p>当然如果你愿意，你可以参考可靠消息最终一致性方案来自己实现一套分布式事务，比如基于 RocketMQ 来玩儿。</p>
<p>参考：</p>
<ul>
<li><a href="https://github.com/doocs/advanced-java/blob/master/docs/distributed-system/distributed-transaction.md">分布式事务了解吗？你们是如何解决分布式事务问题的？</a></li>
</ul>
<h2 id="xa-方案">XA 方案</h2>
<p>两阶段提交方案</p>
<p>有一个事务管理器的概念，负责<strong>协调多个数据库</strong>（资源管理器）的事务，事务管理器先问问各个数据库你准备好了吗？
如果每个数据库都回复 ok，那么就正式提交事务，在各个数据库上执行操作；如果任何其中一个数据库回答不 ok，那么就回滚事务。</p>
<p>这种分布式事务方案，比较适合单块应用里，跨多个库的分布式事务，而且因为严重依赖于数据库层面来搞定复杂的事务，效率很低，绝对不适合高并发的场景。</p>
<p>如果要玩儿，那么基于 <code>Spring + JTA</code> 就可以搞定，自己随便搜个 demo 看看就知道了。</p>
<p>这个方案，我们很少用，一般来说某个系统内部如果出现跨多个库的这么一个操作，是不合规的。</p>
<hr>
<h3 id="tcc">TCC</h3>
<p>这种方案说实话几乎很少人使用，
因为这个事务回滚实际上是严重依赖于你自己写代码来回滚和补偿了，会造成补偿代码巨大，非常之恶心，业务代码是很难维护的。</p>
<p>比如说我们，一般来说跟钱相关的，跟钱打交道的，支付、交易相关的场景，我们会用 TCC，严格保证分布式事务要么全部成功，要么全部自动回滚，严格保证资金的正确性，保证在资金上不会出现问题。</p>
<p>而且最好是你的各个业务执行的时间都比较短。</p>
<p>TCC 分布式事务框架，比如国内开源的</p>
<ul>
<li>ByteTCC</li>
<li>himly</li>
<li>tcc-transaction</li>
</ul>
<h4 id="try">Try</h4>
<p>首先你的业务的主流程以及各个接口提供的业务含义，不是说直接完成那个业务操作，而是完成一个 Try 的操作。</p>
<p>这个操作，一般都是锁定某个资源，设置一个预备类的状态，冻结部分数据，等等，大概都是这类操作。</p>
<h4 id="confirm">Confirm</h4>
<h4 id="cancel">Cancel</h4>
<p>参考：</p>
<ul>
<li><a href="https://juejin.im/post/5bf201f7f265da610f63528a">拜托，面试请不要再问我 TCC 分布式事务的实现原理！</a></li>
</ul>
<hr>
<h3 id="本地消息表">本地消息表</h3>
<p>本地消息表其实是国外的 ebay 搞出来的这么一套思想。</p>
<p>这个大概意思是这样的：</p>
<ol>
<li>A 系统在自己本地一个事务里操作同时，插入一条数据到消息表；</li>
<li>接着 A 系统将这个消息发送到 MQ 中去；</li>
<li>B 系统接收到消息之后，在一个事务里，往自己本地消息表里插入一条数据，同时执行其他的业务操作，如果这个消息已经被处理过了，那么此时这个事务会回滚，这样保证不会重复处理消息；</li>
<li>B 系统执行成功之后，就会更新自己本地消息表的状态以及 A 系统消息表的状态；</li>
<li>如果 B 系统处理失败了，那么就不会更新消息表状态，那么此时 A 系统会定时扫描自己的消息表，如果有未处理的消息，会再次发送到 MQ 中去，让 B 再次处理；</li>
<li>这个方案保证了最终一致性，哪怕 B 事务失败了，但是 A 会不断重发消息，直到 B 那边成功为止。</li>
</ol>
<p>这个方案说实话最大的问题就在于严重依赖于数据库的消息表来管理事务啥的，如果是高并发场景咋办呢？咋扩展呢？所以一般确实很少用。</p>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200529150152.png" alt="" /></p>
<hr>
<h3 id="可靠消息最终一致性方案">可靠消息最终一致性方案</h3>
<p>这个的意思，就是干脆不要用本地的消息表了，直接基于 MQ 来实现事务。比如阿里的 <code>RocketMQ</code> 就支持消息事务。</p>
<p>大概的意思就是：</p>
<ol>
<li>A 系统先发送一个 prepared 消息到 mq，如果这个 prepared 消息发送失败那么就直接取消操作别执行了；</li>
<li>如果这个消息发送成功过了，那么接着执行本地事务，如果成功就告诉 mq 发送确认消息，如果失败就告诉 mq 回滚消息；</li>
<li>如果发送了确认消息，那么此时 B 系统会接收到确认消息，然后执行本地的事务；</li>
<li>mq 会自动定时轮询所有 prepared 消息回调你的接口，问你，这个消息是不是本地事务处理失败了，所以没发送确认的消息，是继续重试还是回滚？一般来说这里你就可以查下数据库看之前本地事务是否执行，如果回滚了，那么这里也回滚吧。这个就是避免可能本地事务执行成功了，而确认消息却发送失败了。</li>
<li>这个方案里，要是系统 B 的事务失败了咋办？重试咯，自动不断重试直到成功，如果实在是不行，要么就是针对重要的资金类业务进行回滚，比如 B 系统本地回滚后，想办法通知系统 A 也回滚；或者是发送报警由人工来手工回滚和补偿。</li>
<li>这个还是比较合适的，目前国内互联网公司大都是这么玩儿的，要不你就用 <code>RocketMQ</code> 支持的，要不你就自己基于类似 <code>ActiveMQ</code>？<code>RabbitMQ</code>？自己封装一套类似的逻辑出来，总之思路就是这样子的。</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200529150059.png" alt="" /></p>
<hr>
<h3 id="最大努力通知方案">最大努力通知方案</h3>
<p>这个方案的大致意思就是：</p>
<ol>
<li>系统 A 本地事务执行完之后，发送个消息到 MQ；</li>
<li>这里会有个专门消费 MQ 的最大努力通知服务，这个服务会消费 MQ 然后写入数据库中记录下来，或者是放入个内存队列也可以，接着调用系统 B 的接口；</li>
<li>要是系统 B 执行成功就 ok 了；要是系统 B 执行失败了，那么最大努力通知服务就定时尝试重新调用系统 B，反复 N 次，最后还是不行就放弃。</li>
</ol>
<hr>
<h3 id="开源实现">开源实现</h3>
<h4 id="seataseatahttpsgithubcomseataseata-github-starshttpsimgshieldsiogithubstarsseataseatasvg"><a href="https://github.com/seata/seata">seata/seata</a> <img src="https://img.shields.io/github/stars/seata/seata.svg" alt="Github stars" /></h4>
<p><code>TXC</code>/<code>GTS</code>/<code>Fescar</code>/<code>Seata</code> 一脉相承</p>
<ul>
<li>2014 年，阿里中间件团队发布 <strong>TXC（Taobao Transaction Constructor）</strong>，为集团内应用提供分布式事务服务。</li>
<li>2016 年，TXC 经过产品化改造，以 <strong>GTS（Global Transaction Service）</strong> 的身份登陆阿里云，成为当时业界唯一一款云上分布式事务产品，在阿云里的公有云、专有云解决方案中，开始服务于众多外部客户。</li>
<li>2019 年起，基于 TXC 和 GTS 的技术积累，阿里中间件团队发起了开源项目 <strong>Fescar（Fast &amp; EaSy Commit And Rollback, FESCAR）</strong>，和社区一起建设这个分布式事务解决方案。</li>
<li>开源分布式事务 <code>Fescar</code> 更名为 <code>Seata</code></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200528161405.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200528161427.png" alt="" /></p>
<h4 id="华为-dtm">华为 DTM</h4>
<p>分布式事务管理中间件（<code>Distributed Transaction Management</code>）是一款用于解决分布式环境下事务一致性问题的产品。在复杂环境下，事务可能会出现的各种异常，DTM 能够将开发者从处理这种异常中解放出来，聚焦于业务逻辑本身。</p>
<p>DTM 支持 TCC（Try-Confirm-Cancel）事务模型，支持以注解的方式定义事务信息，实现事务高效便捷的接入。此外，DTM 具有处理高并发事务请求的能力，支持自动部署、弹性伸缩等全生命周期运维管控能力。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://www.zhihu.com/question/48627764">如何理解 TCC 分布式事务？</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">



  <div>
    
    <a class="flex align-center" href="https://github.com/ikingye/note-cs/commit/18da3d4ed80ed84f1382b6a54c6e64ce7c099d19" title='Last modified by yewang | 2020-05-29' target="_blank" rel="noopener">
      <img src="/note-cs/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>2020-05-29</span>
    </a>
  </div>



</div>

 
        
      </footer>

      
  
  <div class="book-comments">
<script src="https://utteranc.es/client.js"
  repo="ikingye/note-cs"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#分布式事务">分布式事务</a>
      <ul>
        <li><a href="#微服务化带来的分布式事务问题">微服务化带来的分布式事务问题</a></li>
        <li><a href="#解决方案">解决方案</a></li>
        <li><a href="#xa-方案">XA 方案</a>
          <ul>
            <li><a href="#tcc">TCC</a>
              <ul>
                <li><a href="#try">Try</a></li>
                <li><a href="#confirm">Confirm</a></li>
                <li><a href="#cancel">Cancel</a></li>
              </ul>
            </li>
            <li><a href="#本地消息表">本地消息表</a></li>
            <li><a href="#可靠消息最终一致性方案">可靠消息最终一致性方案</a></li>
            <li><a href="#最大努力通知方案">最大努力通知方案</a></li>
            <li><a href="#开源实现">开源实现</a>
              <ul>
                <li><a href="#seataseatahttpsgithubcomseataseata-github-starshttpsimgshieldsiogithubstarsseataseatasvg"><a href="https://github.com/seata/seata">seata/seata</a> <img src="https://img.shields.io/github/stars/seata/seata.svg" alt="Github stars"></a></li>
                <li><a href="#华为-dtm">华为 DTM</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
<a href="https://github.com/ikingye/note-cs"
class="github-corner" aria-label="View source on GitHub">
<svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
  <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
  <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
  <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
</svg></a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>












